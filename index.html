<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kartičky — obrázek ➜ český název (flip)</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--accent:#2b6cb0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:18px; background:var(--bg); color:#111}
    h1{font-size:20px;margin:0 0 12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{perspective:1000px}
    .inner{position:relative;width:100%;padding-top:120%;transition:transform .6s;transform-style:preserve-3d}
    .card.flipped .inner{transform:rotateY(180deg)}
    .face{position:absolute;inset:0;border-radius:12px;box-shadow:0 6px 14px rgba(0,0,0,.08);overflow:hidden;backface-visibility:hidden;background:var(--card);display:flex;align-items:center;justify-content:center}
    .front img{width:100%;height:100%;object-fit:cover}
    .back{transform:rotateY(180deg);padding:14px;box-sizing:border-box;flex-direction:column;gap:6px}
    .label{font-weight:700;text-align:center;font-size:18px}
    .sub{font-size:12px;color:#444;text-align:center}
    .controls{margin:10px 0 18px;display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    input[type=search]{padding:8px;border-radius:8px;border:1px solid #d6dbe6;min-width:220px}
    .note{font-size:13px;color:#333;margin-top:12px}
    footer{margin-top:18px;font-size:13px;color:#444}
  </style>
</head>
<body>
  <h1>Kartičky — klikni na obrázek pro otočení</h1>
  <div class="controls">
    <input id="q" type="search" placeholder="Filtrovat (napiš část názvu)" />
    <button id="refresh">Načíst/obnovit obrázky</button>
  </div>
  <div class="grid" id="grid"></div>
  <p class="note">Tip: klikni na kartičku — obrázek se otočí a ukáže se český název.</p>

<script>
const items = [
  "šťavel kyselý","jaterník podléška","líska obecná","růže šípková","dřín obecný", "jahodník obecný","kopřiva dvoudomá","smrk ztepilý","habr obecný","buk lesní","javor klen","javor mléč","javor babyka","hloh obecný","bez černý","olše lepkavá","konvalinka vonná","pryšec chvojka","jasan ztepilý","hluchavka bílá","bedla vysoká","komár pisklavý","ploštěnka potoční","beruška vodní","jepice obecná (larva)","blešivec potoční","chrostík obecný (larva)","bahnivka rmutná","okružák ploský","plovatka bahenní","komár pisklavý (larva)","hltanovka","beruška vodní","kamomil říční","pošvatka (larva)"
];

const placeholder = 'data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="800"><rect width="100%" height="100%" fill="#e9eef8"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="24" fill="#6b7280">Žádný obrázek</text></svg>`);

const manualImages = {
  "růže šípková": "https://www.herbalista.cz/wp-content/uploads/rosa_canina.jpg",
  "habr obecný": "https://upload.wikimedia.org/wikipedia/commons/f/fe/Illustration_Carpinus_betulus0.jpg",
  "smrk ztepilý": "https://upload.wikimedia.org/wikipedia/commons/8/82/Picea_abies_-_Köhler%E2%80%93s_Medizinal-Pflanzen-105.jpg",
  "buk lesní": "https://hnojik.cz/wp-content/uploads/2024/10/buk-lesni.jpg",
  "javor klen": "https://upload.wikimedia.org/wikipedia/commons/d/d9/Javor_klen_na_Podles%C3%AD_%28ka%C5%A1perskohorsko%29.jpg",
  "olše lepkavá": "https://www.uspza.cz/obrazky5/14-olse_01_big.jpg",
  "blešivec potoční": "https://ziva.avcr.cz/img/ziva/art2/lrg/blesivec-potocni-neskodny-vegetarian-nebo-skryty-p.jpg",
  "dřín obecný": "https://images.squarespace-cdn.com/content/v1/5e66490d184b191cd44942b7/412162ca-170a-4f40-b092-4fbbf45e70cd/drin_obecny.png",
  "javor babyka": "https://upload.wikimedia.org/wikipedia/commons/f/f5/237_Acer_campestre.jpg",
  "pryšec chvojka": "https://www.zahradnictvi-flos.cz/admin/upload/images-cache/53432/900.jpg?v=0b7f4c72c6600fae",
  "hluchavka bílá": "https://www.herbalista.cz/wp-content/uploads/hluchavka_bila.jpg",
  "chrostík obecný (larva)": "http://fotoblog.in/galerie/albums/chrostici-trichoptera/8358623.jpg",
  "pošvatka (larva)": "https://www.prirodniny.cz/wp-content/uploads/2022/10/1310221-5.jpeg"
};

const grid = document.getElementById('grid');
const q = document.getElementById('q');
const refresh = document.getElementById('refresh');

function makeCard(name){
  const card = document.createElement('div'); card.className='card';
  card.dataset.name = name.toLowerCase();
  const inner = document.createElement('div'); inner.className='inner';
  const front = document.createElement('div'); front.className='face front';
  const img = document.createElement('img'); img.alt = name;
  img.src = placeholder;
  front.appendChild(img);
  const back = document.createElement('div'); back.className='face back';
  const label = document.createElement('div'); label.className='label'; label.textContent = name;
  const sub = document.createElement('div'); sub.className='sub'; sub.textContent = 'klikni pro zpět';
  back.appendChild(label); back.appendChild(sub);
  inner.appendChild(front); inner.appendChild(back);
  card.appendChild(inner);
  card.addEventListener('click', ()=> card.classList.toggle('flipped'));

  const io = new IntersectionObserver((entries, obs)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        if(manualImages[name]){
          img.src = manualImages[name];
        }else{
          fetchImage(name).then(url=>{ img.src = url||placeholder; });
        }
        obs.disconnect();
      }
    });
  });
  io.observe(card);

  return card;
}

function render(list){
  grid.innerHTML='';
  list.forEach(name => grid.appendChild(makeCard(name)));
}

q.addEventListener('input', ()=>{
  const term = q.value.trim().toLowerCase();
  Array.from(grid.children).forEach(card=>{
    card.style.display = card.dataset.name.includes(term)?'block':'none';
  });
});

async function fetchImage(term){
  try{
    const wikiUrl = `https://cs.wikipedia.org/w/api.php?action=query&format=json&origin=*&generator=search&gsrsearch=${encodeURIComponent(term)}&gsrlimit=1&prop=pageimages&piprop=original`;
    let r = await fetch(wikiUrl);
    let j = await r.json();
    if(j.query && j.query.pages){
      const pages = Object.values(j.query.pages);
      if(pages.length && pages[0].original && pages[0].original.source) return pages[0].original.source;
    }

    const commonsSearch = `https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&generator=search&gsrsearch=${encodeURIComponent(term)}&gsrlimit=1&prop=imageinfo&iiprop=url`;
    r = await fetch(commonsSearch);
    j = await r.json();
    if(j.query && j.query.pages){
      const pages = Object.values(j.query.pages);
      if(pages.length && pages[0].imageinfo && pages[0].imageinfo[0] && pages[0].imageinfo[0].url) return pages[0].imageinfo[0].url;
    }
  }catch(e){
    console.warn('fetchImage error for',term,e);
  }
  return null;
}

refresh.addEventListener('click', ()=> render(items));

render(items);
</script>
</body>
</html>
